<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.mapper.ScrapMapper">

    <!-- ðŸŸ¦ ìŠ¤í¬ëž© ì¶”ê°€ (ì¤‘ë³µ ì‹œ INSERT IGNORE) -->
    <insert id="addScrap">
        INSERT IGNORE INTO scrap (user_id, lecture_num)
        VALUES (#{user_id}, #{lecture_num})
    </insert>

    <!-- ðŸŸ© íŠ¹ì • íšŒì›ì˜ ìŠ¤í¬ëž© ëª©ë¡ ì¡°íšŒ -->
    <select id="getScrapList" resultType="com.itwillbs.domain.ScrapVO">
        SELECT
            s.scrap_id,
            s.user_num,
            s.lecture_num,
            s.created_at,
            
            l.lecture_title,
            l.lecture_author,
            l.lecture_price,
            l.lecture_img

        FROM scrap s
        JOIN lecture l ON s.lecture_num = l.lecture_num
        WHERE s.user_num = #{user_num}
        ORDER BY s.scrap_id DESC
    </select>

    <!-- ðŸŸ¥ ìŠ¤í¬ëž© ì‚­ì œ -->
    <delete id="deleteScrap">
        DELETE FROM scrap
        WHERE user_num = #{user_num}
          AND lecture_num = #{lecture_num}
    </delete>
	
    <!-- â¬œ í•´ë‹¹ ìŠ¤í¬ëž© ì¡´ìž¬ ì—¬ë¶€ í™•ì¸ -->
    <select id="existsScrap" resultType="int">
        SELECT COUNT(*)
        FROM scrap
        WHERE user_num = #{user_num}
          AND lecture_num = #{lecture_num}
    </select>
<!--     ê²°ì œ í›„ ìŠ¤í¬ëž© ì‚­ì œ -->
    <delete id="deleteScrapAfterPayment">
    DELETE FROM scrap
    WHERE user_num = #{userNum}
      AND lecture_num IN
      <foreach collection="lectureNums" item="lec" open="(" close=")" separator=",">
        #{lec}
      </foreach>
</delete>

</mapper>
