<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.mapper.AdminMapper">

	<select id="listMember" resultType="com.itwillbs.domain.UserVO">
		select *
		from user
		where
		user_role = 'user'
		and user_status = 'active'
		order by user_num desc
		LIMIT #{startRow}, #{pageSize}
	</select>

	<select id="withDrawListMember"
		resultType="com.itwillbs.domain.UserVO">
		SELECT *
		FROM user
		WHERE (user_role = 'user' OR user_role = 'instructor')
		AND (user_status = 'self-withdraw' OR user_status = 'withdraw')
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				AND (user_name LIKE CONCAT('%', #{search}, '%')
				OR user_id LIKE CONCAT('%', #{search}, '%')
				OR user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				AND user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				AND user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				AND user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
		ORDER BY user_num DESC
		LIMIT #{startRow}, #{pageSize}
	</select>

	<select id="countMemberList" resultType="java.lang.Integer">
		select count(*) from user
		WHERE user_role = 'user'
	</select>
	
<!-- 	대시보드 전체 회원수 -->
	<select id="countMemberList1" resultType="java.lang.Integer">
		select count(*) from user
		WHERE user_role = 'user'
	</select>

<!-- 활동 회원 -->
	<select id="memberCount" resultType="java.lang.Integer">
		select count(*) from user
		WHERE user_status = 'active' and user_role = 'user'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (user_name LIKE CONCAT('%', #{search}, '%')
				or user_id LIKE CONCAT('%', #{search}, '%')
				or user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				and user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				and user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				and user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
	</select>

	<!-- 검색 조건이 반영된 탈퇴 회원 카운트 쿼리들 -->
	<select id="instructorDeletecountList" resultType="java.lang.Integer">
		select count(*) from user
		WHERE user_status != 'active' and user_role = 'instructor'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				AND (user_name LIKE CONCAT('%', #{search}, '%')
				OR user_id LIKE CONCAT('%', #{search}, '%')
				OR user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				AND user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				AND user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				AND user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
	</select>

	<select id="inactiveMemberCount" resultType="java.lang.Integer">
		select count(*) from user
		WHERE user_role = 'user' and user_status != 'active'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (user_name LIKE CONCAT('%', #{search}, '%')
				or user_id LIKE CONCAT('%', #{search}, '%')
				or user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				and user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				and user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				and user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
	</select>

	<select id="deletecountMemberList" resultType="java.lang.Integer">
		select count(*) from user
		WHERE user_status != 'active' and user_role = 'user'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				AND (user_name LIKE CONCAT('%', #{search}, '%')
				OR user_id LIKE CONCAT('%', #{search}, '%')
				OR user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				AND user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				AND user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				AND user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
	</select>

	<select id="deleteAllMemberCount" resultType="java.lang.Integer">
		select count(*) from user
		WHERE user_status != 'active'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				AND (user_name LIKE CONCAT('%', #{search}, '%')
				OR user_id LIKE CONCAT('%', #{search}, '%')
				OR user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				AND user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				AND user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				AND user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
	</select>

	<select id="countDrawMemberList" resultType="java.lang.Integer">
		select count(*) from user
		WHERE user_status = 'self-withdraw' or user_status = 'withdraw'
	</select>

	<!-- 활성화된 강사 목록 조회 -->
	<select id="getInstructorList" resultType="com.itwillbs.domain.UserVO">
		SELECT user_num, user_name
		FROM user
		WHERE user_role = 'instructor'
		AND user_status = 'active'
		ORDER BY user_num DESC
	</select>

	<select id="DrawinstructorListMember" resultType="com.itwillbs.domain.UserVO">
		SELECT *
		FROM user
		WHERE user_role = 'instructor'
		AND (user_status = 'self-withdraw' OR user_status = 'withdraw')
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				AND (user_name LIKE CONCAT('%', #{search}, '%')
				OR user_id LIKE CONCAT('%', #{search}, '%')
				OR user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				AND user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				AND user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				AND user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
		ORDER BY user_num DESC
		LIMIT #{startRow}, #{pageSize}
	</select>

	<select id="withDeleteUserMember" resultType="com.itwillbs.domain.UserVO">
		SELECT *
		FROM user
		WHERE user_role = 'user'
		AND (user_status = 'self-withdraw' OR user_status = 'withdraw')
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				AND (user_name LIKE CONCAT('%', #{search}, '%')
				OR user_id LIKE CONCAT('%', #{search}, '%')
				OR user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				AND user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				AND user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				AND user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
		ORDER BY user_num DESC
		LIMIT #{startRow}, #{pageSize}
	</select>

	<select id="countTeacherList" resultType="java.lang.Integer">
		select count(*) from user
		WHERE user_role = 'instructor'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (user_name LIKE CONCAT('%', #{search}, '%')
				or user_id LIKE CONCAT('%', #{search}, '%')
				or user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				and user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				and user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				and user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
	</select>

<!-- 	<insert id="LectureUpdate" parameterType="com.itwillbs.domain.LectureVO"  -->
<!-- 		useGeneratedKeys="true" keyProperty="lecture_num"> -->
<!-- 		INSERT INTO lecture -->
<!-- 		(lecture_title, category_detail, lecture_detail, lecture_author,  -->
<!-- 		lecture_price, lecture_img, lecture_tag, user_num) -->
<!-- 		VALUES(#{lecture_title}, #{category_detail}, #{lecture_detail},  -->
<!-- 		#{lecture_author}, #{lecture_price}, #{lecture_img}, #{lecture_tag}, #{user_num}) -->
<!-- 	</insert> -->

<!-- 	<insert id="insertChapter" parameterType="com.itwillbs.domain.ChapterVO"  -->
<!-- 		useGeneratedKeys="true" keyProperty="chapter_num"> -->
<!-- 		INSERT INTO chapter (lecture_num, chapter_order, chapter_title) -->
<!-- 		VALUES (#{lecture_num}, #{chapter_order}, #{chapter_title}) -->
<!-- 	</insert> -->

<!-- 	<insert id="insertChapterDetail" parameterType="com.itwillbs.domain.ChapterDetailVO" -->
<!-- 		useGeneratedKeys="true" keyProperty="detail_num"> -->
<!-- 		INSERT INTO chapter_detail (chapter_num, detail_order, detail_title, detail_time) -->
<!-- 		VALUES (#{chapter_num}, #{detail_order}, #{detail_title}, #{detail_time}) -->
<!-- 	</insert> -->

	<!-- 강의 리스트 -->
	<select id="listLecture" resultType="com.itwillbs.domain.LectureVO">
		select * from lecture
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				where lecture_title LIKE CONCAT('%', #{search}, '%')
				or lecture_author LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '강사명'">
				where lecture_author LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '강의명'">
				where lecture_title LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
		order by lecture_num desc
		LIMIT #{startRow}, #{pageSize}
	</select>
	
<!-- 승인된 강의 -->
	<select id="okClass" resultType="com.itwillbs.domain.LectureVO">
	    select * from lecture
	    where status = 'approval'
	    <if test="search != null and search != ''">
	        <if test="searchList == '전체'">
	            AND (lecture_title LIKE CONCAT('%', #{search}, '%')
	            OR lecture_author LIKE CONCAT('%', #{search}, '%'))
	        </if>
	        <if test="searchList == '강사명'">
	            AND lecture_author LIKE CONCAT('%', #{search}, '%')
	        </if>
	        <if test="searchList == '강의명'">
	            AND lecture_title LIKE CONCAT('%', #{search}, '%')
	        </if>
	    </if>
	    order by lecture_num desc
	    LIMIT #{startRow}, #{pageSize}
	</select>
	
<!-- 삭제된 강의 -->
	<select id="deleteClass1" resultType="com.itwillbs.domain.LectureVO">
		select * from lecture
		where status = 'delete'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (lecture_title LIKE CONCAT('%', #{search}, '%')
				or lecture_author LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '강사명'">
				and lecture_author LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '강의명'">
				and lecture_title LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
		order by lecture_num desc
		LIMIT #{startRow}, #{pageSize}
	</select>

<!-- 승인요청된 강의 -->
	<select id="askClass" resultType="com.itwillbs.domain.LectureVO">
		select * from lecture
		where status = 'waiting' or status = 'deleteWaiting' or status = 'cancelDelete'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (lecture_title LIKE CONCAT('%', #{search}, '%')
				or lecture_author LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '강사명'">
				and lecture_author LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '강의명'">
				and lecture_title LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
		order by lecture_num desc
		LIMIT #{startRow}, #{pageSize}
	</select>
	
<!-- 반려된 강의 -->
	<select id="compClass" resultType="com.itwillbs.domain.LectureVO">
		select * from lecture
		where status = 'reject'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (lecture_title LIKE CONCAT('%', #{search}, '%')
				or lecture_author LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '강사명'">
				and lecture_author LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '강의명'">
				and lecture_title LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
		order by lecture_num desc
		LIMIT #{startRow}, #{pageSize}
	</select>
	
	<select id="countlectureList" resultType="java.lang.Integer">
	    select count(*) from lecture
	    <where>
	        <if test="search != null and search != ''">
	            <if test="searchList == '전체'">
	                (lecture_title LIKE CONCAT('%', #{search}, '%')
	                OR lecture_author LIKE CONCAT('%', #{search}, '%'))
	            </if>
	            <if test="searchList == '강사명'">
	                lecture_author LIKE CONCAT('%', #{search}, '%')
	            </if>
	            <if test="searchList == '강의명'">
	                lecture_title LIKE CONCAT('%', #{search}, '%')
	            </if>
	        </if>
	    </where>
	</select>

	<delete id="deleteClass">
		delete from lecture where lecture_num = #{lecture_num};
	</delete>

	<select id="insertMember" resultType="com.itwillbs.domain.UserVO">
		select * from user where user_num = #{user_num}
	</select>

	<update id="adminUserUpdate" parameterType="com.itwillbs.domain.UserVO">
		update user set user_role = #{user_role} where user_num = #{user_num}
	</update>

<!-- 클래스 -->
	<select id="classEdit" parameterType="int" resultType="com.itwillbs.domain.LectureVO">
		select * from lecture where lecture_num = #{lecture_num}
	</select>
	
		<!-- 강사별 강의 갯수 카운트 -->
	<select id="lectureCount" parameterType="int" resultType="String">
    	SELECT COUNT(*) 
    	FROM lecture
    	WHERE user_num = #{user_num}
	</select>

	<select id="classSearch" parameterType="int" resultType="com.itwillbs.domain.UserVO">
		select * from user where user_num = #{user_num}
	</select>

	<update id="adminEditClass" parameterType="com.itwillbs.domain.LectureVO">
		update lecture
		set lecture_title = #{lecture_title},
		category_detail = #{category_detail}, 
		lecture_detail = #{lecture_detail},
		lecture_author = #{lecture_author}, 
		lecture_price = #{lecture_price}, 
		lecture_img = #{lecture_img}
		where lecture_num = #{lecture_num}
	</update>

	<!-- 강사 조회 -->
	<select id="listTeacher" resultType="com.itwillbs.domain.UserVO">
		select * from user
		WHERE user_role = 'instructor'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (user_name LIKE CONCAT('%', #{search}, '%')
				or user_id LIKE CONCAT('%', #{search}, '%')
				or user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				and user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				and user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				and user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
		order by user_num desc
		LIMIT #{startRow}, #{pageSize}
	</select>

	<!-- 회원 목록 -->
	<select id="MemberList" resultType="com.itwillbs.domain.UserVO">
		select * from user
		WHERE user_role = 'user'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (user_name LIKE CONCAT('%', #{search}, '%')
				or user_id LIKE CONCAT('%', #{search}, '%')
				or user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				and user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				and user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				and user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
		order by user_num desc
		LIMIT #{startRow}, #{pageSize}
	</select>

	<!-- 활동 강사 -->
	<select id="activeTeacherList" resultType="com.itwillbs.domain.UserVO">
		select * from user
		WHERE user_role = 'instructor' and user_status = 'active'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (user_name LIKE CONCAT('%', #{search}, '%')
				or user_id LIKE CONCAT('%', #{search}, '%')
				or user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				and user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				and user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				and user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
		order by user_num desc
		LIMIT #{startRow}, #{pageSize}
	</select>
	
	<select id="activeMemberList" resultType="com.itwillbs.domain.UserVO">
		select * from user
		WHERE user_role = 'user' and user_status = 'active'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (user_name LIKE CONCAT('%', #{search}, '%')
				or user_id LIKE CONCAT('%', #{search}, '%')
				or user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				and user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				and user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				and user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
		order by user_num desc
		LIMIT #{startRow}, #{pageSize}
	</select>

<!-- 비활동 강사 -->
	<select id="inactiveTeacherList" resultType="com.itwillbs.domain.UserVO">
		select * from user
		WHERE user_role = 'instructor' and user_status != 'active'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (user_name LIKE CONCAT('%', #{search}, '%')
				or user_id LIKE CONCAT('%', #{search}, '%')
				or user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				and user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				and user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				and user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
		order by user_num desc
		LIMIT #{startRow}, #{pageSize}
	</select>

<!-- 회원목록에서 탈퇴회원 조회 -->
	<select id="inactiveMemberList" resultType="com.itwillbs.domain.UserVO">
		select * from user
		WHERE user_role = 'user' and user_status != 'active'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (user_name LIKE CONCAT('%', #{search}, '%')
				or user_id LIKE CONCAT('%', #{search}, '%')
				or user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				and user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				and user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				and user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
		order by user_num desc
		LIMIT #{startRow}, #{pageSize}
	</select>

	<select id="teacharCount" resultType="java.lang.Integer">
		select count(*) from user
		WHERE user_role = 'instructor' and user_status = 'active'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (user_name LIKE CONCAT('%', #{search}, '%')
				or user_id LIKE CONCAT('%', #{search}, '%')
				or user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				and user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				and user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				and user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
	</select>

	<select id="inactiveTeacharCount" resultType="java.lang.Integer">
		select count(*) from user
		WHERE user_role = 'instructor' and user_status != 'active'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (user_name LIKE CONCAT('%', #{search}, '%')
				or user_id LIKE CONCAT('%', #{search}, '%')
				or user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				and user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				and user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				and user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
	</select>

	<!-- 검색 조건이 반영된 강사 카운트 쿼리들 -->
	<select id="activeTeacherListCount" resultType="java.lang.Integer">
		select count(*) from user
		WHERE user_role = 'instructor' and user_status = 'active'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (user_name LIKE CONCAT('%', #{search}, '%')
				or user_id LIKE CONCAT('%', #{search}, '%')
				or user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				and user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				and user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				and user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
	</select>

	<select id="inactiveTeacherListCount" resultType="java.lang.Integer">
		select count(*) from user
		WHERE user_role = 'instructor' and user_status != 'active'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (user_name LIKE CONCAT('%', #{search}, '%')
				or user_id LIKE CONCAT('%', #{search}, '%')
				or user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				and user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				and user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				and user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
	</select>

	<select id="listTeacherCount" resultType="java.lang.Integer">
		select count(*) from user
		WHERE user_role = 'instructor'
		<if test="search != null and search != ''">
			<if test="searchList == '전체'">
				and (user_name LIKE CONCAT('%', #{search}, '%')
				or user_id LIKE CONCAT('%', #{search}, '%')
				or user_email LIKE CONCAT('%', #{search}, '%'))
			</if>
			<if test="searchList == '이름'">
				and user_name LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '아이디'">
				and user_id LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="searchList == '이메일'">
				and user_email LIKE CONCAT('%', #{search}, '%')
			</if>
		</if>
	</select>

	<!-- 강의 갯수 카운트 -->
	<select id="classCount" resultType="java.lang.Integer">
		select count(*) from lecture
	</select>
	
	<!-- 승인된 강의 갯수 카운트 -->
	<select id="okClassCount" resultType="java.lang.Integer">
		select count(*) from lecture
		where status = 'approval'
		<if test="search != null and search != ''">
	        <choose>
	            <when test="searchList == '전체'">
	                AND (lecture_title LIKE CONCAT('%', #{search}, '%')
	                OR lecture_author LIKE CONCAT('%', #{search}, '%'))
	            </when>
	            <when test="searchList == '강사명'">
	                AND lecture_author LIKE CONCAT('%', #{search}, '%')
	            </when>
	            <when test="searchList == '강의명'">
	                AND lecture_title LIKE CONCAT('%', #{search}, '%')
	            </when>
	        </choose>
	    </if>
	</select>
	
	<!-- 삭제된 강의 갯수 카운트 -->
	<select id="deleteClassCount" resultType="java.lang.Integer">
	    select count(*) from lecture
	    where status = 'delete'
	    <choose>
            <when test="searchList == '전체'">
                AND (lecture_title LIKE CONCAT('%', #{search}, '%')
                OR lecture_author LIKE CONCAT('%', #{search}, '%'))
            </when>
            <when test="searchList == '강사명'">
                AND lecture_author LIKE CONCAT('%', #{search}, '%')
            </when>
            <when test="searchList == '강의명'">
                AND lecture_title LIKE CONCAT('%', #{search}, '%')
            </when>
        </choose>
	</select>

	<!-- 승인 요청된 강의 갯수 카운트 -->
	<select id="askClassCount" resultType="java.lang.Integer">
		select count(*) from lecture
		where status = 'waiting' or status = 'deleteWaiting' or status = 'cancelDelete'
		<choose>
            <when test="searchList == '전체'">
                AND (lecture_title LIKE CONCAT('%', #{search}, '%')
                OR lecture_author LIKE CONCAT('%', #{search}, '%'))
            </when>
            <when test="searchList == '강사명'">
                AND lecture_author LIKE CONCAT('%', #{search}, '%')
            </when>
            <when test="searchList == '강의명'">
                AND lecture_title LIKE CONCAT('%', #{search}, '%')
            </when>
        </choose>
	</select>

	<!-- 반려 된 강의 갯수 카운트 -->
	<select id="compClassCount" resultType="java.lang.Integer">
	    select count(*) from lecture
	    where status = 'reject'
	    <choose>
            <when test="searchList == '전체'">
                AND (lecture_title LIKE CONCAT('%', #{search}, '%')
                OR lecture_author LIKE CONCAT('%', #{search}, '%'))
            </when>
            <when test="searchList == '강사명'">
                AND lecture_author LIKE CONCAT('%', #{search}, '%')
            </when>
            <when test="searchList == '강의명'">
                AND lecture_title LIKE CONCAT('%', #{search}, '%')
            </when>
        </choose>
	</select>

	<update id="deleteMember" parameterType="int">
		update user set user_status = 'withdraw' where user_num = #{user_num}
	</update>

	<update id="RevertMember" parameterType="int">
		update user set user_status = 'active' where user_num = #{user_num}
	</update>

<!-- 카테고리 메인 추가 -->
	<insert id="addCateMain" parameterType="com.itwillbs.domain.Category_mainVO">
		INSERT INTO category_main (category_main_name)
		value (#{category_main_name})
	</insert>

<!-- 카테고리 리스트 -->
	<select id="categoryList" resultType="com.itwillbs.domain.CategoryVO">
		select * from category
		order by category_order ASC
	</select>
	
	<!-- 카테고리 메인 리스트 -->
   <select id="categoMainryList" resultType="com.itwillbs.domain.Category_mainVO">
      select * from category_main
      ORDER BY category_main_order ASC
   </select>
   
<!-- 카테고리 메인 삭제 -->
	<delete id="CateMainDelete">
		delete from category_main where category_main_name = #{category_main_name};
	</delete>
	
	<!-- 카테고리 추가 -->
	<insert id="addCategoty" parameterType="com.itwillbs.domain.CategoryVO">
		INSERT INTO category (category_main_name, category_detail)
		value (#{category_main_name}, #{category_detail})
	</insert>
	
	<!-- 카테고리 삭제 -->
	<delete id="deleteCategory">
		delete from category where category_num = #{category_num};
	</delete>

	<!-- 카테고리 수정 -->
	<update id="updateCategory">
    	UPDATE category
    	SET category_main_name = #{category_main_name},
        	category_detail = #{category_detail}
    	WHERE category_num = #{category_num}
	</update>
	
	<!-- 챕터 목록 조회 (lecture_num으로) -->
	<select id="getChaptersByLectureNum" parameterType="int" resultMap="ChapterResultMap">
    	SELECT 
        	c.chapter_num,
        	c.lecture_num,
        	c.chapter_order,
        	c.chapter_title,
        	cd.detail_num,
        	cd.chapter_num as detail_chapter_num,
        	cd.detail_order,
        	cd.detail_title,
        	cd.detail_time
    	FROM chapter c
    	LEFT JOIN chapter_detail cd ON c.chapter_num = cd.chapter_num
    	WHERE c.lecture_num = #{lecture_num}
    	ORDER BY c.chapter_order, cd.detail_order
	</select>

	<!-- ResultMap 정의 -->
	<resultMap id="ChapterResultMap" type="com.itwillbs.domain.ChapterVO">
    	<id property="chapter_num" column="chapter_num"/>
    	<result property="lecture_num" column="lecture_num"/>
    	<result property="chapter_order" column="chapter_order"/>
    	<result property="chapter_title" column="chapter_title"/>
    	<collection property="detailList" ofType="com.itwillbs.domain.ChapterDetailVO">
        	<id property="detail_num" column="detail_num"/>
        	<result property="chapter_num" column="detail_chapter_num"/>
        	<result property="detail_order" column="detail_order"/>
        	<result property="detail_title" column="detail_title"/>
        	<result property="detail_time" column="detail_time"/>
    	</collection>
	</resultMap>
	
	<!-- 강의 정보 업데이트 -->
	<update id="updateLecture" parameterType="com.itwillbs.domain.LectureVO">
    	UPDATE lecture
    	SET lecture_title = #{lecture_title},
        	category_detail = #{category_detail},
        	lecture_detail = #{lecture_detail},
        	lecture_author = #{lecture_author},
        	lecture_price = #{lecture_price},
        	lecture_img = #{lecture_img},
        	lecture_tag = #{lecture_tag},
        	user_num = #{user_num},
        	status = 'waiting'
    	WHERE lecture_num = #{lecture_num}
	</update>

	<!-- 특정 강의의 모든 챕터 삭제 (연쇄 삭제로 챕터 상세도 함께 삭제됨) -->
	<delete id="deleteChaptersByLectureNum" parameterType="int">
    	DELETE FROM chapter
    	WHERE lecture_num = #{lecture_num}
	</delete>
	
	<!-- 강사 정보 조회 (상세보기용) -->
	<!-- 기존 teacherClassCheck를 이렇게 수정 -->
	<!-- 강사별 강의 목록 조회 (통계 포함) -->
	<select id="teacherClassCheck" parameterType="int" resultType="com.itwillbs.domain.LectureVO">
	    SELECT 
	        l.lecture_num,
	        l.user_num,
	        l.lecture_title,
	        l.lecture_author,
	        l.lecture_price,
	        l.category_detail,
	        l.lecture_img,
	        l.lecture_detail,
	        l.lecture_tag,
	        l.created_at,
	        COALESCE(rs.avg_score, 0) as avg_score,
	        COALESCE(rs.review_count, 0) as review_count,
	        COALESCE(es.student_count, 0) as student_count
	    FROM 
	        lecture l
	        LEFT JOIN (
	            SELECT 
	                lecture_num,
	                ROUND(AVG(review_score), 1) as avg_score,
	                COUNT(*) as review_count
	            FROM review
	            GROUP BY lecture_num
	        ) rs ON l.lecture_num = rs.lecture_num
	        LEFT JOIN (
	            SELECT 
	                lecture_num,
	                COUNT(DISTINCT enrollment_id) as student_count
	            FROM enrollment
	            GROUP BY lecture_num
	        ) es ON l.lecture_num = es.lecture_num
	    WHERE l.user_num = #{user_num}
	    ORDER BY l.lecture_num DESC
	</select>
	
	<!-- 강사 정보 조회 (상세보기용) -->
	<select id="teachercheck" parameterType="int" resultType="com.itwillbs.domain.UserVO">
    	SELECT *
    	FROM user
    	WHERE user_num = #{user_num}
    	AND user_role = 'instructor'
	</select>
	
	<!-- 강의 승인 -->
	<update id="classApprovalUpdate">
    	UPDATE lecture
    	SET status = 'approval'
    	WHERE lecture_num = #{lecture_num}
	</update>
	
	<!-- 강의 미승인 -->
	<update id="classReject">
    	UPDATE lecture
    	SET status = 'reject'
    	WHERE lecture_num = #{lecture_num}
	</update>
	
	<!-- 강의 미승인 사유 -->
	<insert id="classNotApproval" parameterType="com.itwillbs.domain.Category_mainVO">
		INSERT INTO notApproved (lecture_num, reason)
		value (#{lecture_num}, #{reason})
	</insert>
	
	<!-- 강의 삭제 -->
	<update id="classApprovaldelete">
    	UPDATE lecture
    	SET status = 'delete'
    	WHERE lecture_num = #{lecture_num}
	</update>
	
	<!-- 강의 삭제 취소 -->
	<update id="cancelDelete">
    	UPDATE lecture
    	SET status = 'waiting'
    	WHERE lecture_num = #{lecture_num}
	</update>
	
	<select id="getCategoryDetailPaymentStats" resultType="map">
		<![CDATA[
		    SELECT 
		        c.category_main_name as categoryName,
		        COUNT(*) as paymentCount,
		        COALESCE(SUM(pd.sale_price), 0) as totalAmount
		    FROM payment_detail pd
		    INNER JOIN lecture l ON pd.lecture_num = l.lecture_num
		    INNER JOIN category c ON l.category_detail = c.category_detail
		    WHERE pd.created_at >= DATE_FORMAT(DATE_SUB(NOW(), INTERVAL 1 MONTH), '%Y-%m-01')
		      AND pd.created_at < DATE_FORMAT(NOW(), '%Y-%m-01')
		    GROUP BY c.category_main_name
		    ORDER BY paymentCount DESC
		]]>
	</select>
	
	<select id="bestClassTop10" resultType="map">
	    SELECT 
	        l.lecture_num as lecture_num,
	        l.lecture_title as lecture_title,
	        l.lecture_author as lecture_author,
	        l.lecture_img as lecture_img,
	        l.category_detail as category_detail,
	        COUNT(s.scrap_id) as scrapCount
	    FROM lecture l
	    INNER JOIN scrap s ON l.lecture_num = s.lecture_num
	    GROUP BY l.lecture_num, l.lecture_title, l.lecture_author, l.lecture_img, l.category_detail
	    ORDER BY scrapCount DESC
	    LIMIT 10
	</select>
	
	<select id="monthlySales" resultType="map">
	    SELECT 
	        DATE_FORMAT(created_at, '%Y-%m') as yearMonth,
	        SUM(sale_price) as totalSales
	    FROM payment_detail
	    WHERE YEAR(created_at) = YEAR(NOW())
	    GROUP BY DATE_FORMAT(created_at, '%Y-%m')
	    ORDER BY DATE_FORMAT(created_at, '%Y-%m')
	</select>
	
	<select id="getcategoryList" resultType="map">
	    SELECT 
	        category_main_name as categoryName
	    FROM category_main
	    ORDER BY category_main_order
	</select>
		<!-- 승인된 강의 갯수 카운트(대시보드용) -->
	<select id="okClassCount1" resultType="java.lang.Integer">
		select count(*) from lecture
		where status = 'approval'
	</select>
	
<!-- 	탈퇴회원 대시보드용 -->
	<select id="inactiveMemberCount1" resultType="java.lang.Integer">
		select count(*) from user
		WHERE user_role = 'user' and user_status != 'active'
	</select>
	
<!-- 	총 강사수 대시보드용 -->
	<select id="countTeacherList1" resultType="java.lang.Integer">
		select count(*) from user
		WHERE user_role = 'instructor'
	</select>
	
<!-- 	대시보드 이번달 매출 -->
	<select id="monthsSales" resultType="java.lang.Integer">
		SELECT SUM(sale_price) AS this_month_sales
		FROM  payment_detail
		WHERE YEAR(created_at) = YEAR(CURDATE())
		      AND MONTH(created_at) = MONTH(CURDATE())
	</select>
	
<!-- 전년도 월 평균 대비 이번달 매출 (%) -->
	<select id="averageSales" resultType="java.lang.Integer">
		SELECT ROUND(SUM(sale_price) / 12) AS last_year_month_avg
		FROM payment_detail
		WHERE YEAR(created_at) = YEAR(CURDATE()) - 1
	</select>
	
<!-- 이번달 결제된 강의수 -->
	<select id="lectureSold" resultType="java.lang.Integer">
		SELECT COUNT(*) 
		FROM payment_detail
		WHERE status = 'paid'
		AND YEAR(created_at) = YEAR(CURDATE())
		AND MONTH(created_at) = MONTH(CURDATE())
	</select>
	
<!-- 이번달 환불된 강의수 -->
	<select id="lectureRefunded" resultType="java.lang.Integer">
		SELECT COUNT(*)
        FROM payment_detail
        WHERE status = 'refunded'
		AND YEAR(created_at) = YEAR(CURDATE())
		AND MONTH(created_at) = MONTH(CURDATE())
	</select>
	
<!-- 신고관리(미처리) -->
	<select id="declaration" resultType="java.lang.Integer">
		SELECT COUNT(*)
        FROM report_action_log
        WHERE action = 'PENDING'
	</select>
	
	<!-- 승인 요청된 강의 갯수 대시보드 -->
	<select id="askClassCount1" resultType="java.lang.Integer">
		select count(*) from lecture
		where status = 'waiting' or status = 'deleteWaiting' or status = 'cancelDelete'
	</select>
	
	<!-- 이번달 가입자(대시보드) -->
	<select id="newPerson" resultType="java.lang.Integer">
		SELECT count(*)
		FROM user
		WHERE MONTH(created_at) = MONTH(CURRENT_DATE())
		  AND YEAR(created_at) = YEAR(CURRENT_DATE());
	</select>
	
	
	
</mapper>