<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.mapper.CommunityMapper">

	<!-- ====================================================== 0. Îã®Ïùº Ïπ¥Ïö¥Ìä∏ ====================================================== -->
	<select id="getCommunityCount" resultType="int">
<![CDATA[
SELECT COUNT(*)
FROM community_content
WHERE category_main_num = #{category_main_num}
  AND is_deleted = 0   -- üî• ÏÇ≠Ï†úÍ∏Ä Ï†úÏô∏ Ï∂îÍ∞Ä
]]>
	</select>



	<!-- ====================================================== üî• 1. Ìï´ÌÜ†ÌîΩ (summary 
		= 120Ïûê) ‚Äª CDATA Ï†ÅÏö© ====================================================== -->

	<select id="getHotTopicList"
		resultType="com.itwillbs.domain.CommunityContentVO">
<![CDATA[
SELECT
    c.post_id,
    c.title,

    SUBSTRING(
        REGEXP_REPLACE(
            REGEXP_REPLACE(
                REGEXP_REPLACE(c.content, '<[^>]*>', ''),
                '[<>]', ''
            ),
            '&[^;]+;', ''
        ), 1, 120
    ) AS summary,

    COUNT(DISTINCT l.like_id) AS like_count,
    COUNT(DISTINCT cc.comment_id) AS comment_count,
    c.views,
    c.created_at,

    u.user_name,
    u.user_file,
    cm.category_main_name AS category_name,

    (
        (COUNT(DISTINCT l.like_id) * 4)
        + (COUNT(DISTINCT cc.comment_id) * 3)
        + (c.views * 0.2)
    )
    /
    POW(TIMESTAMPDIFF(HOUR, c.created_at, NOW()) + 1, 1.3) AS trendingScore

FROM community_content c
JOIN user u ON c.user_num = u.user_num
LEFT JOIN category_main cm ON c.category_main_num = cm.category_main_num
LEFT JOIN community_content_like l ON l.post_id = c.post_id
LEFT JOIN community_comment cc ON cc.post_id = c.post_id

WHERE c.is_deleted = 0        -- üî• ÏÇ≠Ï†úÍ∏Ä Ï†úÏô∏
  AND c.created_at >= NOW() - INTERVAL 24 HOUR

GROUP BY c.post_id
ORDER BY trendingScore DESC
LIMIT 10
]]>
	</select>





	<!-- ====================================================== 
			2. Ïù∏Í∏∞Í∏Ä (summary = 60Ïûê) ‚Äª CDATA Ï†ÅÏö© 
		====================================================== -->
	<select id="getPopularPosts"
		resultType="com.itwillbs.domain.CommunityContentVO">
<![CDATA[
SELECT
    c.post_id,
    c.title,
    c.views,
    c.created_at,
    u.user_name,
    u.user_file,
    cm.category_main_name,

    SUBSTRING(
        REGEXP_REPLACE(
            REGEXP_REPLACE(
                REGEXP_REPLACE(c.content, '<[^>]*>', ''),
                '[<>]', ''
            ),
            '&[^;]+;', ''
        ), 1, 60
    ) AS summary,

    (SELECT COUNT(*)
     FROM community_content_like l
     WHERE l.post_id = c.post_id AND l.is_like = 1) AS like_count

FROM community_content c
JOIN user u ON c.user_num = u.user_num
JOIN category_main cm ON c.category_main_num = cm.category_main_num

WHERE c.is_deleted = 0   -- üî• ÏÇ≠Ï†úÍ∏Ä Ï†úÏô∏

ORDER BY like_count DESC, c.views DESC
LIMIT 5
]]>
	</select>






	<!-- ====================================================== 
	4. ÏÉÅÎã® Î©îÏù∏ Ïπ¥ÌÖåÍ≥†Î¶¨ Î¶¨Ïä§Ìä∏ 
	====================================================== -->
	<select id="getCategoryMainList"
		resultType="com.itwillbs.domain.CommunityContentVO">
		SELECT
		category_main_num,
		category_main_name
		FROM
		category_main
		ORDER BY category_main_num ASC
	</select>



	<!-- ====================================================== 5. Í≤åÏãúÍ∏Ä Î™©Î°ù (summary 
		= 120Ïûê) ‚Äª CDATA Ï†ÅÏö© ====================================================== -->
	<select id="getCommunityList"
		resultType="com.itwillbs.domain.CommunityContentVO">

    <![CDATA[
    SELECT
        c.post_id,
        c.title,
        c.content,
        c.user_num,
        c.tag,
        c.views,
        c.is_visible,
        c.is_deleted,
        c.category_main_num,
        c.lecture_num,
        c.category_id,
        c.created_at,
        c.updated_at,

        u.user_name,
        u.user_file,
        cm.category_main_name,
        cc.category_name AS category_name,
        cc.category_key AS category_key,

        -- summary 120Ïûê (HTML Ï†úÍ±∞)
        SUBSTRING(
            REGEXP_REPLACE(
                REGEXP_REPLACE(
                    REGEXP_REPLACE(c.content, '<[^>]*>', ''),
                    '[<>]', ''
                ),
                '&[^;]+;', ''
            ),
            1, 120
        ) AS summary,

        (SELECT COUNT(*)
         FROM community_comment cc2
         WHERE cc2.post_id = c.post_id AND cc2.is_deleted = 0) AS comment_count,

        (SELECT COUNT(*)
         FROM community_content_like l1
         WHERE l1.post_id = c.post_id AND l1.is_like = 1) AS like_count

    FROM community_content c
    JOIN user u ON c.user_num = u.user_num
    JOIN category_main cm ON c.category_main_num = cm.category_main_num
    LEFT JOIN community_category cc ON c.category_id = cc.category_id
    ]]>

		<where>

			<if test="category_id != null">
				AND c.category_id = #{category_id}
			</if>

			<if test="category_main_num != null">
				AND c.category_main_num = #{category_main_num}
			</if>

			<choose>
				<when test="period == 'today'">
					AND DATE(c.created_at) = CURDATE()
				</when>
				<when test="period == 'week'">
					AND c.created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)
				</when>
				<when test="period == 'month'">
					AND c.created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
				</when>
			</choose>

			<if test="keyword != null and keyword != ''">
				<choose>
					<when test="searchType == 'title'">
						AND c.title LIKE CONCAT('%', #{keyword}, '%')
					</when>

					<when test="searchType == 'titleContent'">
						AND (c.title LIKE CONCAT('%', #{keyword}, '%')
						OR
						c.content LIKE CONCAT('%', #{keyword}, '%'))
					</when>

					<when test="searchType == 'writer'">
						AND u.user_name LIKE CONCAT('%', #{keyword}, '%')
					</when>

					<when test="searchType == 'comment'">
						AND EXISTS (
						SELECT 1
						FROM community_comment co
						WHERE
						co.post_id = c.post_id
						AND co.is_deleted = 0
						AND co.content LIKE
						CONCAT('%', #{keyword}, '%')
						)
					</when>
				</choose>
			</if>

			AND c.is_deleted = 0
		</where>

		<choose>
			<when test="sort == 'views'">
				ORDER BY c.views DESC
			</when>
			<when test="sort == 'likes'">
				ORDER BY like_count DESC
			</when>
			<when test="sort == 'comments'">
				ORDER BY comment_count DESC
			</when>
			<otherwise>
				ORDER BY c.created_at DESC
			</otherwise>
		</choose>

		LIMIT #{amount} OFFSET #{offset}

	</select>





	<!-- ====================================================== 6. Ï¥ù Í∞úÏàò (Ïù¥Í±¥ 
		summary ÏóÜÏùå) ====================================================== -->
	<select id="getTotalCount" resultType="int">

    <![CDATA[
    SELECT COUNT(DISTINCT c.post_id)
    FROM community_content c
    JOIN user u ON c.user_num = u.user_num
    LEFT JOIN community_category cc ON c.category_id = cc.category_id
    LEFT JOIN community_comment co ON co.post_id = c.post_id
    ]]>

		<where>

			<if test="category_id != null">
				AND c.category_id = #{category_id}
			</if>

			<if test="category_main_num != null">
				AND c.category_main_num = #{category_main_num}
			</if>

			<choose>
				<when test="period == 'today'">
					AND DATE(c.created_at) = CURDATE()
				</when>
				<when test="period == 'week'">
					AND c.created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)
				</when>
				<when test="period == 'month'">
					AND c.created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
				</when>
			</choose>

			<if test="keyword != null and keyword != ''">
				<choose>
					<when test="searchType == 'title'">
						AND c.title LIKE CONCAT('%', #{keyword}, '%')
					</when>

					<when test="searchType == 'titleContent'">
						AND (c.title LIKE CONCAT('%', #{keyword}, '%')
						OR
						c.content LIKE CONCAT('%', #{keyword}, '%'))
					</when>

					<when test="searchType == 'writer'">
						AND u.user_name LIKE CONCAT('%', #{keyword}, '%')
					</when>

					<when test="searchType == 'comment'">
						AND co.content LIKE CONCAT('%', #{keyword}, '%')
					</when>
				</choose>
			</if>

			AND c.is_deleted = 0
		</where>

	</select>



	<!-- Í≤åÏãúÍ∏Ä ÏÉÅÏÑ∏ Ï°∞Ìöå -->
	<select id="getPostDetailWithLike"
		resultType="com.itwillbs.domain.CommunityContentVO">

<![CDATA[
SELECT
    c.*,
    u.user_name,
    u.user_file,
    cc.category_name,
    cm.category_main_name,

    -- Ï¢ãÏïÑÏöî Ïó¨Î∂Ä
    (
        SELECT is_like
        FROM community_content_like l
        WHERE l.post_id = c.post_id
          AND l.user_num = #{user_num}
        LIMIT 1
    ) AS user_reaction,

    -- Ï¢ãÏïÑÏöîÏàò
    (SELECT COUNT(*) FROM community_content_like l1
        WHERE l1.post_id = c.post_id AND l1.is_like = 1) AS like_count,

    -- ÎåìÍ∏Ä Ïàò
    (SELECT COUNT(*) FROM community_comment co
        WHERE co.post_id = c.post_id AND co.is_deleted = 0) AS comment_count

FROM community_content c
JOIN user u ON c.user_num = u.user_num
LEFT JOIN community_category cc ON c.category_id = cc.category_id
LEFT JOIN category_main cm ON c.category_main_num = cm.category_main_num

WHERE c.post_id = #{post_id}
  AND c.is_deleted = 0   -- üî• ÏÇ≠Ï†úÍ∏Ä Ï†úÏô∏ Ï∂îÍ∞Ä
]]>
	</select>




	<!-- ============================================================ üìå Í≤åÏãúÍ∏Ä 
		ÎåìÍ∏Ä Ï†ÑÏ≤¥ Ï°∞Ìöå (Ï¢ãÏïÑÏöî/Ïã´Ïñ¥Ïöî + ÏûëÏÑ±Ïûê Ìè¨Ìï®) - ONLY_FULL_GROUP_BY ÌôòÍ≤ΩÏóêÏÑúÎèÑ 100% ÎèôÏûë - ÎåìÍ∏Ä Ï¢ãÏïÑÏöî/Ïã´Ïñ¥Ïöî 
		ÏïàÏ†Ñ Ìï©ÏÇ∞ - ÌòÑÏû¨ Ïú†Ï†ÄÏùò Ï¢ãÏïÑÏöî ÏÉÅÌÉú Î∂ÑÎ¶¨ ÏïàÏ†ï ============================================================ -->
	<select id="getCommentsByPostId"
		resultType="com.itwillbs.domain.CommunityCommentVO">

		SELECT
		c.comment_id,
		c.post_id,
		c.user_num,
		c.parent_id,
		c.content,
		c.is_deleted,
		c.created_at,
		c.updated_at,

		u.user_name,
		u.user_file,

		-- Ï¢ãÏïÑÏöî Ïàò
		COALESCE(SUM(CASE WHEN cl.is_like = 1 THEN 1 END), 0) AS like_count,

		-- Ïã´Ïñ¥Ïöî Ïàò
		COALESCE(SUM(CASE WHEN cl.is_like = 0 THEN 1 END), 0) AS dislike_count,

		-- ÌòÑÏû¨ Ïú†Ï†Ä Ï¢ãÏïÑÏöî ÏÉÅÌÉú
		(
		SELECT cl2.is_like
		FROM community_comment_like cl2
		WHERE cl2.comment_id = c.comment_id
		AND cl2.user_num = #{user_num}
		LIMIT 1
		) AS my_like_status

		FROM community_comment c

		JOIN user u
		ON c.user_num = u.user_num

		LEFT JOIN community_comment_like cl
		ON c.comment_id = cl.comment_id

		WHERE c.post_id = #{post_id}
		AND c.is_deleted = 0

		-- ‚ö†Ô∏è ONLY_FULL_GROUP_BYÎ•º Í≥†Î†§Ìïú ÏôÑÏ†Ñ Í∑∏Î£πÌôî
		GROUP BY
		c.comment_id,
		c.post_id,
		c.user_num,
		c.parent_id,
		c.content,
		c.is_deleted,
		c.created_at,
		c.updated_at,
		u.user_name,
		u.user_file

		ORDER BY
		c.parent_id ASC,
		c.comment_id ASC
	</select>





	<!-- ================================================================ üî• 
		Prev/Next + ÌòÑÏû¨ Í∏Ä Ìè¨Ìï® (ÏúÑ3 + ÌòÑÏû¨ + ÏïÑÎûò3 ‚Üí Ï¥ù 7Í∞ú) ================================================================ -->
	<select id="getPrevNextPosts"
		resultType="com.itwillbs.domain.CommunityContentVO">

<![CDATA[
WITH filtered AS (

    -- üîµ 1) ÌïÑÌÑ∞ Ï†ÅÏö© + ÌòÑÏû¨ Í∏Ä Í∞ïÏ†ú Ìè¨Ìï®
    SELECT
        c.post_id,
        c.title,
        c.content,
        c.user_num,
        u.user_name,
        c.category_id,
        c.category_main_num,
        c.created_at,
        c.views,
        c.is_deleted,

        -- Ï¢ãÏïÑÏöî Ïàò (alias)
        (SELECT COUNT(*)
         FROM community_content_like l
         WHERE l.post_id = c.post_id AND l.is_like = 1) AS like_count,

        -- ÎåìÍ∏Ä Ïàò (alias)
        (SELECT COUNT(*)
         FROM community_comment cm
         WHERE cm.post_id = c.post_id AND cm.is_deleted = 0) AS comment_count,

        ROW_NUMBER() OVER (
            ORDER BY
]]>
		<choose>
			<!-- üîπ Ï°∞ÌöåÏàò Ï†ïÎ†¨ -->
			<when test="cri.sort == 'views'">
            <![CDATA[ c.views DESC ]]>
			</when>

			<!-- üîπ Ï¢ãÏïÑÏöî Ï†ïÎ†¨ -->
			<when test="cri.sort == 'likes'">
            <![CDATA[
                (SELECT COUNT(*)
                 FROM community_content_like l2
                 WHERE l2.post_id = c.post_id AND l2.is_like = 1) DESC
            ]]>
			</when>

			<!-- üîπ ÎåìÍ∏ÄÏàò Ï†ïÎ†¨ -->
			<when test="cri.sort == 'comments'">
            <![CDATA[
                (SELECT COUNT(*)
                 FROM community_comment cm2
                 WHERE cm2.post_id = c.post_id AND cm2.is_deleted = 0) DESC
            ]]>
			</when>

			<!-- üîπ Í∏∞Î≥∏ = ÏµúÏã†Ïàú -->
			<otherwise>
            <![CDATA[ c.created_at DESC ]]>
			</otherwise>
		</choose>
<![CDATA[
        ) AS rn

    FROM community_content c
    JOIN user u ON c.user_num = u.user_num

    WHERE c.is_deleted = 0
]]>

		<!-- üî• ÌïÑÌÑ∞ Ï°∞Í±¥ -->
		<if test="cri.category_id != null">
			AND c.category_id = #{cri.category_id}
		</if>

		<if test="cri.category_main_num != null">
			AND c.category_main_num = #{cri.category_main_num}
		</if>

		<choose>
			<when test="cri.period == 'today'">
				AND DATE(c.created_at) = CURDATE()
			</when>
			<when test="cri.period == 'week'">
				AND c.created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)
			</when>
			<when test="cri.period == 'month'">
				AND c.created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
			</when>
		</choose>

		<if test="cri.keyword != null and cri.keyword != ''">
			<choose>
				<when test="cri.searchType == 'title'">
					AND c.title LIKE CONCAT('%', #{cri.keyword}, '%')
				</when>
				<when test="cri.searchType == 'titleContent'">
					AND (c.title LIKE CONCAT('%', #{cri.keyword}, '%')
					OR c.content LIKE CONCAT('%', #{cri.keyword}, '%'))
				</when>
				<when test="cri.searchType == 'writer'">
					AND u.user_name LIKE CONCAT('%', #{cri.keyword}, '%')
				</when>
				<when test="cri.searchType == 'comment'">
					AND EXISTS (
					SELECT 1 FROM community_comment co
					WHERE co.post_id = c.post_id
					AND co.is_deleted = 0
					AND co.content LIKE CONCAT('%', #{cri.keyword}, '%')
					)
				</when>
			</choose>
		</if>

		), current_post AS (
		SELECT rn
		FROM filtered
		WHERE post_id = #{post_id}
		)

		-- üî• ÏµúÏ¢Ö Í≤∞Í≥º: ÏúÑ3 + ÌòÑÏû¨ + ÏïÑÎûò3 (Ï¥ù 7Í∞ú)
		SELECT f.*
		FROM filtered f
		JOIN current_post cp
		WHERE f.rn BETWEEN GREATEST(CAST(cp.rn AS SIGNED) - 3, 1)
		AND (CAST(cp.rn AS SIGNED) + 3)
		ORDER BY f.rn ASC

	</select>







	<!-- ============================================================ üìå Í≤åÏãúÍ∏Ä 
		Ï°∞ÌöåÏàò Ï¶ùÍ∞Ä ============================================================ -->
	<update id="updateViewCount">
		UPDATE community_content
		SET views = views + 1
		WHERE
		post_id = #{post_id}
	</update>



	<!-- ============ Ï¢ãÏïÑÏöî Í¥ÄÎ†® =================== -->
	<!-- ========================================================= -->
	<!-- üìå Í≤åÏãúÍ∏Ä Ï¢ãÏïÑÏöî -->
	<!-- ========================================================= -->

	<insert id="upsertPostLike">
		INSERT INTO community_content_like (post_id,
		user_num, is_like)
		VALUES (#{post_id}, #{user_num}, 1)
		ON DUPLICATE KEY
		UPDATE
		is_like = 1
	</insert>

	<delete id="deletePostLike">
		DELETE FROM community_content_like
		WHERE post_id =
		#{post_id}
		AND user_num = #{user_num}
	</delete>


	<!-- ========================================================= -->
	<!-- üìå ÎåìÍ∏Ä Ï¢ãÏïÑÏöî -->
	<!-- ========================================================= -->

	<insert id="upsertCommentLike">
		INSERT INTO community_comment_like (comment_id,
		user_num, is_like)
		VALUES (#{comment_id}, #{user_num}, 1)
		ON DUPLICATE
		KEY UPDATE
		is_like = 1
	</insert>

	<delete id="deleteCommentLike">
		DELETE FROM community_comment_like
		WHERE comment_id =
		#{comment_id}
		AND user_num = #{user_num}
	</delete>

	<!-- ====================================================== üìå Í≤åÏãúÍ∏Ä ÏûëÏÑ± (INSERT) 
		useGeneratedKeys ‚Üí post_id ÏûêÎèô Îß§Ìïë ====================================================== -->
	<insert id="insertPost"
		parameterType="com.itwillbs.domain.CommunityContentVO"
		useGeneratedKeys="true" keyProperty="post_id">

		INSERT INTO community_content
		(
		title,
		content,
		user_num,
		category_id,
		category_main_num,
		created_at,
		updated_at,
		is_visible,
		is_deleted
		)
		VALUES
		(
		#{title},
		#{content},
		#{user_num},
		#{category_id},
		#{category_main_num},
		NOW(),
		NOW(),
		1,
		0
		)
	</insert>


	<!-- ====================================================== üìå Ïπ¥ÌÖåÍ≥†Î¶¨ Î™©Î°ù ====================================================== -->
	<select id="getCategoryList"
		resultType="com.itwillbs.domain.CommunityCategoryVO">
		SELECT
		category_id,
		category_name
		FROM community_category
		ORDER BY category_id
	</select>


	<!-- ====================================================== üìå Î©îÏù∏ Ïπ¥ÌÖåÍ≥†Î¶¨ Î™©Î°ù 
		====================================================== -->
	<select id="getMainCategoryList"
		resultType="com.itwillbs.domain.Category_mainVO">
		SELECT
		category_main_num,
		category_main_name
		FROM category_main
		ORDER BY category_main_num
	</select>


	<!-- ====================================================== üìå Îã®Ïùº Í≤åÏãúÍ∏Ä Ï°∞Ìöå 
		(ÏàòÏ†ï/ÏÇ≠Ï†ú Ï†Ñ Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏Ïö©) - user_num ÎπÑÍµêÌï¥ÏÑú Î≥∏Ïù∏ Í∏ÄÏù∏ÏßÄ ÌåêÎã®ÌïòÍ∏∞ ÏúÑÌï¥ ÏÇ¨Ïö© ======================================================= -->
	<select id="getPostById" parameterType="int"
		resultType="com.itwillbs.domain.CommunityContentVO">
		SELECT
		post_id,
		title,
		content,
		user_num,
		category_id,
		category_main_num,
		views,
		created_at,
		updated_at,
		is_deleted
		FROM community_content
		WHERE post_id = #{post_id}
		AND is_deleted = 0
	</select>



	<!-- ====================================================== üìå Í≤åÏãúÍ∏Ä ÏàòÏ†ï ======================================================= -->
	<update id="updatePost"
		parameterType="com.itwillbs.domain.CommunityContentVO">
		UPDATE community_content
		SET
		title = #{title},
		content = #{content},
		category_id = #{category_id},
		category_main_num = #{category_main_num},
		updated_at = NOW()
		WHERE post_id = #{post_id}
		AND is_deleted = 0
	</update>



	<!-- ====================================================== üìå Í≤åÏãúÍ∏Ä ÏÇ≠Ï†ú (Soft 
		Delete Î∞©Ïãù) Ïã§Ï†ú ÏÇ≠Ï†úÍ∞Ä ÏïÑÎãàÎùº is_deleted = 1 Î°ú Î≥ÄÍ≤Ω ======================================================= -->
	<update id="deletePost" parameterType="int">
		UPDATE community_content
		SET is_deleted = 1
		WHERE post_id = #{post_id}
	</update>


<!-- ============================================================
     üí¨ ÎåìÍ∏Ä INSERT (ÎåìÍ∏Ä / ÎåÄÎåìÍ∏Ä Í≥µÏö©)
     parent_id = NULL ‚Üí ÎåìÍ∏Ä
     parent_id = Í∞í    ‚Üí ÎåÄÎåìÍ∏Ä
============================================================ -->
<insert id="insertComment" parameterType="com.itwillbs.domain.CommunityCommentVO">
    INSERT INTO community_comment
    (
        post_id,
        user_num,
        parent_id,
        content,
        created_at,
        updated_at,
        is_deleted,
        report_count
    )
    VALUES
    (
        #{post_id},
        #{user_num},
        #{parent_id},
        #{content},
        NOW(),
        NOW(),
        0,
        0
    )
</insert>



<!-- ============================================================
     ‚úè ÎåìÍ∏Ä UPDATE (Î≥∏Ïù∏ ÎåìÍ∏ÄÎßå ÏàòÏ†ï)
============================================================ -->
<update id="updateComment">
    UPDATE community_comment
    SET
        content = #{content},
        updated_at = NOW()
    WHERE comment_id = #{comment_id}
      AND user_num = #{user_num}
      AND is_deleted = 0
</update>



<!-- ============================================================
     ‚ùå ÎåìÍ∏Ä DELETE (Soft Delete Î∞©Ïãù)
============================================================ -->
<update id="deleteComment">
    UPDATE community_comment
    SET is_deleted = 1
    WHERE comment_id = #{comment_id}
      AND user_num = #{user_num}
      AND is_deleted = 0
</update>






</mapper>
