<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.mapper.GradeMapper">

<!--     누적 결제금액으로 등급 찾기 -->
    <select id="getGradeByTotalPayment" parameterType="int" resultType="com.itwillbs.domain.GradeVO">
        SELECT *
        FROM grade
        WHERE #{totalPayment} BETWEEN min_payment AND max_payment
        LIMIT 1;
    </select>

<!--      (선택) 전체 등급 가져오기  -->
    <select id="getAllGrades" resultType="com.itwillbs.domain.GradeVO">
        SELECT *
        FROM grade
        ORDER BY grade_id ASC;
    </select>
  <!-- 
        ==============================================================
            회원 번호로 등급 조회
            - user.grade_id → grade.grade_id JOIN
            - 페이지 진입 시 할인율/적립률 계산에 필요
        ==============================================================
    -->
    <select id="getGradeByUser" resultType="com.itwillbs.domain.GradeVO">
        SELECT 
            g.grade_id,
            g.grade_name,
            g.min_payment,
            g.max_payment,
            g.discount_rate,
            g.reward_rate,
            g.created_at,
            g.updated_at
        FROM grade g
        JOIN user u ON g.grade_id = u.grade_id
        WHERE u.user_num = #{user_num}
    </select>

    <!-- 
        ==============================================================
            등급 ID로 단일 등급 조회
        ==============================================================
    -->
    <select id="getGradeById" resultType="com.itwillbs.domain.GradeVO">
        SELECT 
            grade_id,
            grade_name,
            min_payment,
            max_payment,
            discount_rate,
            reward_rate,
            created_at,
            updated_at
        FROM grade
        WHERE grade_id = #{grade_id}
    </select>
</mapper>
